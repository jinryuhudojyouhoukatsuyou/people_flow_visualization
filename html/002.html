<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Display a map</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
<script src="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.js"></script>
<script src="https://d3js.org/d3.v5.min.js"></script>
<link href="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css" rel="stylesheet" />
<link rel="icon" type="image/png" sizes="32x32" href="data:image/png;base64,
iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsSAAAL
EgHS3X78AAADsElEQVRYhcVXPYgTQRR+WYIWFuZqm1wfcIUQrLwc2AZX2FpS2Fhl
BUvJvk1z7aYXLlhvsRCszXVnWHAPUolILMRChLU4RItEXvJNbrK3m028EweWney8
ee973/uZSWk+n9P/HMZ12e4F9WovqDd33bcTAGZvyuy1c5ZjInrbe93qbZC5GgAi
MonIYfZ8WnptyqMLzMvnP4nIYvZiZq+QkcIc6AV1MdYhon7XjsR4RUAYtWFIRO8h
do+IEiKqdu1oREu2xLgPZpjZnW4NgNljIhIam0ZtOCCiAyI66drRyiN4vgLQtaM4
ywCz5whgIhowu7wRAFCLwdGSajeBIYuIwrQRRX+ecU2vsMbQI3rDNQDMXhWGCQKZ
CntB3YI3ifIKS23QXcFbgIkzo64drbxm9kysL/ZIWMr4YS0F3KKkMREOgiI1Fwce
YT6C8YP0ZjjWZPZGcMBZhYDZG0Aot4S0cCTw3tHAtMFACEAiG3ftKNR1pO0YFwvL
D0pAN9oL6gz6V5nctaMEQNTQ52qsZX6Wk5eqQAMgm2OjNnRUFYBeF+uH0ngy5p4W
gpPZpOXjdyWL4TKMKspM0Kfi9xh1fIC3Ss4zAPyhgZVvdyFT0fYkCM9tAYQSX+iS
JDSYvQQfTLwlO0vw0J9NWpXZpLUvTQjxlO9W146m8KyJuYToUGREdjZp7cle5IoF
nW3dltguuS5fKo1USFaNxKgNZe0YnjdTnXAEL5/D8KI0mV0/pW+t5PUqsAAkROtM
tE2rRlLa+/aqdOf0KTzWAYT0vXY6+7p/v0gH1gaXklD1eaBfCWnrOltyHiwms0kr
2dTIcDoyZHwd2KazQGWuKByl1nW2KKvF0vqBJCPMOgvK6Q/6frx9uQdordbUwFmQ
AVDP1DLfQUWpZpXZZTfeB8RzZtdUMYWSKbxVGT7A3MFaE7LisZlmbxcGdCADLcaL
Yfcb7RuVmw+X8zfTgMcDrU9sPf7qTmj3GxKO49+lXx/lkTm+7Tx2BmD3GxV1QwLV
jHkHa9fGQJ6yKt4xylXy40PBnlxgeTkQLpNoUUZrDSXojGO73/iMpHsCQEdENAw6
43QX1ZuPlWUokwFpJMxuFeUUox3rw4JXZziwvhDRg5TxtlaSZt4tq/BWjN7NF1fy
i7J6cfTspTEvn3+69U7OByfojHnb2/DWADQgqr4TAJmiYwpjDKC+aj5F9b8zAA2I
uoD6WnIleedH0di5DGFAVUIHDyHOOxmXcaV/x6BdQG2M8z8DcOVBRH8AJvDu27IP
CuMAAAAASUVORK5CYII=" />
<style>
    body {
      width: 99%;
    }
    .map { height: 800px; }
    .flexbox {
      display: flex;
      flex-direction: row;
      text-align: center;
      background-color: #fafafa;
      margin: 10px;
    }
    .flex_title{
      border: 1px solid #000;
      width: 100%;
      text-align: center;
      font-size: 16pt;
    } 
    .flex_map{
      padding: 5px;
      width: 100%;
      height: 800px;
    } 
    .flex_map_2{
      width: 100%;
      text-align: left;
      margin-right: 350px;
    } 
    .flex_menu{
      padding: 20px;
      width: 350px;
      text-align: left;
    }  
    .btn-blue{
      border-radius: 5px;
      background-color: #3078ba;
      padding: 10px;
      text-align: center;
      color: white;
      width:300px;
      margin-left:20px;
      margin-top:5px;
      border: 1px;
    }
    table{
      margin-top:-10px;
      margin-left:20px;
      width: 300px; /* flex_mapのwidth/2*/
      border-collapse:  collapse;
      /* background-color: #9cceeb; */
    }
    th,td {
      width: 150px;
      text-align: center;
      border: solid 1px gray;
    }
    .value_id{
      background-color: #ccc;
      font-weight:bold;
    }
    .sensor_id{
      background-color: #ccc;
      font-weight:bold;
    }

    .none {
	    display: none;
    }

    .legend_box_2{
      padding-top:55px;
    }

    .grapy_legend{
      display: inline-block;
      padding:10px;
      font-size: 14px;
    }

    /* 軸の値のスタイル */
    .x_axis {
    	font-size: 11px; 
    }
    .y_axis {
    	font-size: 12px; 
    }
    /* 軸の文字のスタイル */
    .axis2 {
    	font-size: 14px; 
    }
    .box_srcollbar {
        overflow:auto;
        margin-right: 350px;
    }
    select {
      z-index: 1;
      position: absolute;
      top: 5px;
      right: 5px;
      padding: 5px;
      background: white;
    }
    fieldset {
      z-index: 1;
      position: absolute;
      top: 50px;
      right: 5px;
      padding: 5px;
      background: white;
      text-align: left;
    }
    p,
    label {
        font: 1rem 'Fira Sans', sans-serif;
    }

    input {
        margin: 0.4rem;
    }
    @page {
        size: A4 landscape;
    }
    .pages {
        break-before: page;
    }
</style>
</head>
<body>

  <div class="flexbox">
    <div class="flex_title">
      <div>MLIT People Flow Visualization Tool 人流データ可視化ツール</div>
    </div>
</div>

<!--地図-->
<div class="flexbox">
    <div class="flex_map">
        <div id="map" class="map">
          <select id="styles" class="dropdownSelect">
            <option value="style1">ダークモード</option>
            <option value="style2">地理院地図</option>
          </select>          
          <fieldset>
            <legend></legend>
            <div>
              <input type="checkbox" id="point" name="point" checked>
              <label for="point">ポイントデータ</label>
            </div>
          </fieldset>
        </div>
    </div>
    <div class="flex_menu">
    <!-- 個別表 -->
      <table id="sensor_table">
        <tbody>
          <tr>
            <td class="value_id" colspan="2">センサー情報</td>
          </tr>
          <tr>
            <td>ID</td>
            <td><div id="sensor_id"></div></td>
          </tr>
          <tr>
            <td>のべ人数</td>
            <td><div id="sensor_value"></div></td>
          </tr>
          <tr>
            <td>名前</td>
            <td><div id="sensor_name"></div></td>
          </tr>
          <tr>
            <td>Option1</td>
            <td><div id="sensor_option1"></div></td>
          </tr>
          <tr>
            <td>Option2</td>
            <td><div id="sensor_option2"></div></td>
          </tr>
          <tr>
            <td>Option3</td>
            <td><div id="sensor_option3"></div></td>
          </tr>
          <tr>
            <td>Option4</td>
            <td><div id="sensor_option4"></div></td>
          </tr>
          <tr>
            <td>Option5</td>
            <td><div id="sensor_option5"></div></td>
          </tr>
        </tbody>
      </table>
      <br>
      <table id="info_table">
        <tbody>
          <tr>
            <td class="value_id" colspan="4">抽出条件</td>
          </tr>
          <tr>
            <td><div>filter_col1_name_replace</div></td>
            <td><div>filter_col1_value_replace</div></td>
            <td><div>filter_col6_name_replace</div></td>
            <td><div>filter_col6_value_replace</div></td>
          </tr>
          <tr>
            <td><div>filter_col2_name_replace</div></td>
            <td><div>filter_col2_value_replace</div></td>
            <td><div>filter_col7_name_replace</div></td>
            <td><div>filter_col7_value_replace</div></td>
          </tr>
          <tr>
            <td><div>filter_col3_name_replace</div></td>
            <td><div>filter_col3_value_replace</div></td>
            <td><div>filter_col8_name_replace</div></td>
            <td><div>filter_col8_value_replace</div></td>
          </tr>
          <tr>
            <td><div>filter_col4_name_replace</div></td>
            <td><div>filter_col4_value_replace</div></td>
            <td><div>filter_col9_name_replace</div></td>
            <td><div>filter_col9_value_replace</div></td>
          </tr>
          <tr>
            <td><div>filter_col5_name_replace</div></td>
            <td><div>filter_col5_value_replace</div></td>
            <td><div>filter_col10_name_replace</div></td>
            <td><div>filter_col10_value_replace</div></td>
          </tr>
        </tbody>
      </table>
      <br>
      <button class="btn-blue" type="button" onclick="window.print()">PDFを出力する</button>
      <br>
      <button class="btn-blue" type="button" onclick="clearData()">選択クリア</button>
    </div>
</div>



<!--グラフ-->
<div class="flexbox pages">
    <div class="flex_map_2">
        <div id="graph_dataviz" class="box_srcollbar"></div>
    </div>
</div>

<!--凡例-->
<div id="legend_box" class="legend_box" >
  legend_replace
  <!--
	<div class="grapy_legend"><span id="sp_111">　</span>：定点A</div>
  -->
</div>

<script>

style_json = {


"version": 8,
"name": "Dark Matter without labels",
"metadata": { "maputnik:renderer": "mbgljs" },
"sources": {
  "carto": {
    "type": "vector",
    "url": "https://tiles.basemaps.cartocdn.com/vector/carto.streets/v1/tiles.json"
  }
},
"sprite": "https://tiles.basemaps.cartocdn.com/gl/dark-matter-gl-style/sprite",
"glyphs": "https://tiles.basemaps.cartocdn.com/fonts/{fontstack}/{range}.pbf",
"layers": [
  {
    "id": "background",
    "type": "background",
    "layout": { "visibility": "visible" },
    "paint": { "background-color": "#0e0e0e", "background-opacity": 1 }
  },
  {
    "id": "landcover",
    "type": "fill",
    "source": "carto",
    "source-layer": "landcover",
    "filter": [
      "any",
      ["==", "class", "wood"],
      ["==", "class", "grass"],
      ["==", "subclass", "recreation_ground"]
    ],
    "paint": {
      "fill-color": {
        "stops": [
          [8, "#0e0e0e"],
          [9, "#0e0e0e"],
          [11, "#0e0e0e"],
          [13, "#0e0e0e"],
          [15, "#0e0e0e"]
        ]
      },
      "fill-opacity": 1
    }
  },
  {
    "id": "park_national_park",
    "type": "fill",
    "source": "carto",
    "source-layer": "park",
    "minzoom": 9,
    "filter": ["all", ["==", "class", "national_park"]],
    "layout": { "visibility": "visible" },
    "paint": {
      "fill-color": {
        "stops": [
          [8, "#0e0e0e"],
          [9, "#0e0e0e"],
          [11, "#0e0e0e"],
          [13, "#0e0e0e"],
          [15, "#0e0e0e"]
        ]
      },
      "fill-opacity": 1,
      "fill-translate-anchor": "map"
    }
  },
  {
    "id": "park_nature_reserve",
    "type": "fill",
    "source": "carto",
    "source-layer": "park",
    "minzoom": 0,
    "filter": ["all", ["==", "class", "nature_reserve"]],
    "layout": { "visibility": "visible" },
    "paint": {
      "fill-color": {
        "stops": [
          [8, "#0e0e0e"],
          [9, "#0e0e0e"],
          [11, "#0e0e0e"],
          [13, "#0e0e0e"],
          [15, "#0e0e0e"]
        ]
      },
      "fill-antialias": true,
      "fill-opacity": {
        "stops": [
          [6, 0.7],
          [9, 0.9]
        ]
      }
    }
  },
  {
    "id": "landuse_residential",
    "type": "fill",
    "source": "carto",
    "source-layer": "landuse",
    "minzoom": 6,
    "filter": ["any", ["==", "class", "residential"]],
    "paint": {
      "fill-color": {
        "stops": [
          [5, "rgba(0, 0, 0, 0.5)"],
          [8, "rgba(0, 0, 0, 0.45)"],
          [9, "rgba(0, 0, 0, 0.4)"],
          [11, "rgba(0, 0, 0, 0.35)"],
          [13, "rgba(0, 0, 0, 0.3)"],
          [15, "rgba(0, 0, 0, 0.25)"],
          [16, "rgba(0, 0, 0, 0.15)"]
        ]
      },
      "fill-opacity": {
        "stops": [
          [6, 0.6],
          [9, 1]
        ]
      }
    }
  },
  {
    "id": "landuse",
    "type": "fill",
    "source": "carto",
    "source-layer": "landuse",
    "filter": ["any", ["==", "class", "cemetery"], ["==", "class", "stadium"]],
    "paint": {
      "fill-color": {
        "stops": [
          [8, "#0e0e0e"],
          [9, "#0e0e0e"],
          [11, "#0e0e0e"],
          [13, "#0e0e0e"],
          [15, "#0e0e0e"]
        ]
      }
    }
  },
  {
    "id": "waterway",
    "type": "line",
    "source": "carto",
    "source-layer": "waterway",
    "paint": {
      "line-color": "rgba(63, 90, 109, 1)",
      "line-width": {
        "stops": [
          [8, 0.5],
          [9, 1],
          [15, 2],
          [16, 3]
        ]
      }
    }
  },
  {
    "id": "boundary_county",
    "type": "line",
    "source": "carto",
    "source-layer": "boundary",
    "minzoom": 9,
    "maxzoom": 24,
    "filter": ["all", ["==", "admin_level", 6], ["==", "maritime", 0]],
    "paint": {
      "line-color": {
        "stops": [
          [4, "#222"],
          [5, "#222"],
          [6, "#2C353C"]
        ]
      },
      "line-width": {
        "stops": [
          [4, 0.5],
          [7, 1]
        ]
      },
      "line-dasharray": {
        "stops": [
          [6, [1]],
          [7, [2, 2]]
        ]
      }
    }
  },
  {
    "id": "boundary_state",
    "type": "line",
    "source": "carto",
    "source-layer": "boundary",
    "minzoom": 4,
    "filter": ["all", ["==", "admin_level", 4], ["==", "maritime", 0]],
    "paint": {
      "line-color": {
        "stops": [
          [4, "rgba(103, 103, 114, 1)"],
          [5, "rgba(103, 103, 114, 1)"],
          [6, "rgba(103, 103, 114, 1)"]
        ]
      },
      "line-width": {
        "stops": [
          [4, 0.5],
          [7, 1],
          [8, 1],
          [9, 1.2]
        ]
      },
      "line-dasharray": {
        "stops": [
          [6, [1, 2, 3]],
          [7, [1, 2, 3]]
        ]
      }
    }
  },
  {
    "id": "water",
    "type": "fill",
    "source": "carto",
    "source-layer": "water",
    "minzoom": 0,
    "maxzoom": 24,
    "filter": ["all", ["==", "$type", "Polygon"]],
    "layout": { "visibility": "visible" },
    "paint": {
      "fill-color": "#2C353C",
      "fill-antialias": true,
      "fill-translate-anchor": "map",
      "fill-opacity": 1
    }
  },
  {
    "id": "water_shadow",
    "type": "fill",
    "source": "carto",
    "source-layer": "water",
    "minzoom": 0,
    "filter": ["all", ["==", "$type", "Polygon"]],
    "layout": { "visibility": "visible" },
    "paint": {
      "fill-color": "transparent",
      "fill-antialias": true,
      "fill-translate-anchor": "map",
      "fill-opacity": 1,
      "fill-translate": {
        "stops": [
          [0, [0, 2]],
          [6, [0, 1]],
          [14, [0, 1]],
          [17, [0, 2]]
        ]
      }
    }
  },
  {
    "id": "aeroway-runway",
    "type": "line",
    "source": "carto",
    "source-layer": "aeroway",
    "minzoom": 12,
    "filter": ["all", ["==", "class", "runway"]],
    "layout": { "line-cap": "square" },
    "paint": {
      "line-width": {
        "stops": [
          [11, 1],
          [13, 4],
          [14, 6],
          [15, 8],
          [16, 10]
        ]
      },
      "line-color": "#111"
    }
  },
  {
    "id": "aeroway-taxiway",
    "type": "line",
    "source": "carto",
    "source-layer": "aeroway",
    "minzoom": 13,
    "filter": ["all", ["==", "class", "taxiway"]],
    "paint": {
      "line-color": "#111",
      "line-width": {
        "stops": [
          [13, 0.5],
          [14, 1],
          [15, 2],
          [16, 4]
        ]
      }
    }
  },
  {
    "id": "tunnel_service_case",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 15,
    "maxzoom": 24,
    "filter": ["all", ["==", "class", "service"], ["==", "brunnel", "tunnel"]],
    "layout": { "line-cap": "round", "line-join": "round" },
    "paint": {
      "line-width": {
        "stops": [
          [15, 1],
          [16, 3],
          [17, 6],
          [18, 8]
        ]
      },
      "line-opacity": 1,
      "line-color": "#1a1a1a"
    }
  },
  {
    "id": "tunnel_minor_case",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 13,
    "maxzoom": 24,
    "filter": ["all", ["==", "class", "minor"], ["==", "brunnel", "tunnel"]],
    "layout": { "line-cap": "butt", "line-join": "miter" },
    "paint": {
      "line-width": {
        "stops": [
          [11, 0.5],
          [12, 0.5],
          [14, 2],
          [15, 4],
          [16, 6],
          [17, 10],
          [18, 14]
        ]
      },
      "line-opacity": 1,
      "line-color": "#1a1a1a"
    }
  },
  {
    "id": "tunnel_sec_case",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 11,
    "maxzoom": 24,
    "filter": ["all", ["in", "class", "secondary", "tertiary"], ["==", "brunnel", "tunnel"]],
    "layout": { "line-cap": "round", "line-join": "round" },
    "paint": {
      "line-width": {
        "stops": [
          [11, 0.5],
          [12, 1],
          [13, 2],
          [14, 5],
          [15, 6],
          [16, 8],
          [17, 12],
          [18, 16]
        ]
      },
      "line-opacity": 1,
      "line-color": "#1a1a1a"
    }
  },
  {
    "id": "tunnel_pri_case",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 8,
    "maxzoom": 24,
    "filter": ["all", ["==", "class", "primary"], ["!=", "ramp", 1], ["==", "brunnel", "tunnel"]],
    "layout": { "line-cap": "butt", "line-join": "round" },
    "paint": {
      "line-width": {
        "stops": [
          [6, 0.5],
          [7, 0.8],
          [8, 1],
          [11, 3],
          [13, 4],
          [14, 6],
          [15, 8],
          [16, 10],
          [17, 14],
          [18, 18]
        ]
      },
      "line-opacity": {
        "stops": [
          [5, 0.5],
          [7, 1]
        ]
      },
      "line-color": "#1a1a1a"
    }
  },
  {
    "id": "tunnel_trunk_case",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 5,
    "maxzoom": 24,
    "filter": ["all", ["==", "class", "trunk"], ["!=", "ramp", 1], ["==", "brunnel", "tunnel"]],
    "layout": {
      "line-cap": "butt",
      "line-join": "round",
      "visibility": "visible"
    },
    "paint": {
      "line-width": {
        "stops": [
          [6, 0.5],
          [7, 0.8],
          [8, 1],
          [11, 3],
          [13, 4],
          [14, 6],
          [15, 8],
          [16, 10],
          [17, 14],
          [18, 18]
        ]
      },
      "line-opacity": {
        "stops": [
          [5, 0.5],
          [7, 1]
        ]
      },
      "line-color": "#232323"
    }
  },
  {
    "id": "tunnel_mot_case",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 5,
    "maxzoom": 24,
    "filter": [
      "all",
      ["==", "class", "motorway"],
      ["!=", "ramp", 1],
      ["==", "brunnel", "tunnel"]
    ],
    "layout": { "line-cap": "butt", "line-join": "round" },
    "paint": {
      "line-width": {
        "stops": [
          [6, 0.5],
          [7, 0.8],
          [8, 1],
          [11, 3],
          [12, 4],
          [13, 5],
          [14, 7],
          [15, 9],
          [16, 11],
          [17, 13],
          [18, 22]
        ]
      },
      "line-opacity": {
        "stops": [
          [6, 0.5],
          [7, 1]
        ]
      },
      "line-color": "#232323"
    }
  },
  {
    "id": "tunnel_path",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 15,
    "maxzoom": 24,
    "filter": ["all", ["==", "class", "path"], ["==", "brunnel", "tunnel"]],
    "layout": { "line-cap": "round", "line-join": "round" },
    "paint": {
      "line-width": {
        "stops": [
          [15, 0.5],
          [16, 1],
          [18, 3]
        ]
      },
      "line-opacity": 1,
      "line-color": "#262626",
      "line-dasharray": {
        "stops": [
          [15, [2, 2]],
          [18, [3, 3]]
        ]
      }
    }
  },
  {
    "id": "tunnel_service_fill",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 15,
    "maxzoom": 24,
    "filter": ["all", ["==", "class", "service"], ["==", "brunnel", "tunnel"]],
    "layout": { "line-cap": "round", "line-join": "round" },
    "paint": {
      "line-width": {
        "stops": [
          [15, 2],
          [16, 2],
          [17, 4],
          [18, 6]
        ]
      },
      "line-opacity": 1,
      "line-color": "#161616"
    }
  },
  {
    "id": "tunnel_minor_fill",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 15,
    "maxzoom": 24,
    "filter": ["all", ["==", "class", "minor"], ["==", "brunnel", "tunnel"]],
    "layout": { "line-cap": "butt", "line-join": "round" },
    "paint": {
      "line-width": {
        "stops": [
          [15, 3],
          [16, 4],
          [17, 8],
          [18, 12]
        ]
      },
      "line-opacity": 1,
      "line-color": "rgba(22, 22, 22, 1)"
    }
  },
  {
    "id": "tunnel_sec_fill",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 13,
    "maxzoom": 24,
    "filter": ["all", ["in", "class", "secondary", "tertiary"], ["==", "brunnel", "tunnel"]],
    "layout": { "line-cap": "round", "line-join": "round" },
    "paint": {
      "line-width": {
        "stops": [
          [11, 2],
          [13, 2],
          [14, 3],
          [15, 4],
          [16, 6],
          [17, 10],
          [18, 14]
        ]
      },
      "line-opacity": 1,
      "line-color": "#161616"
    }
  },
  {
    "id": "tunnel_pri_fill",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 11,
    "maxzoom": 24,
    "filter": ["all", ["==", "class", "primary"], ["!=", "ramp", 1], ["==", "brunnel", "tunnel"]],
    "layout": { "line-cap": "butt", "line-join": "round" },
    "paint": {
      "line-width": {
        "stops": [
          [11, 1],
          [13, 2],
          [14, 4],
          [15, 6],
          [16, 8],
          [17, 12],
          [18, 16]
        ]
      },
      "line-opacity": 1,
      "line-color": "rgba(65, 71, 88, 1)"
    }
  },
  {
    "id": "tunnel_trunk_fill",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 11,
    "maxzoom": 24,
    "filter": ["all", ["==", "class", "trunk"], ["!=", "ramp", 1], ["==", "brunnel", "tunnel"]],
    "layout": {
      "line-cap": "round",
      "line-join": "round",
      "visibility": "visible"
    },
    "paint": {
      "line-width": {
        "stops": [
          [11, 1],
          [13, 2],
          [14, 4],
          [15, 6],
          [16, 8],
          [17, 12],
          [18, 16]
        ]
      },
      "line-opacity": 1,
      "line-color": "#161616"
    }
  },
  {
    "id": "tunnel_mot_fill",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 10,
    "maxzoom": 24,
    "filter": [
      "all",
      ["==", "class", "motorway"],
      ["!=", "ramp", 1],
      ["==", "brunnel", "tunnel"]
    ],
    "layout": { "line-cap": "butt", "line-join": "round" },
    "paint": {
      "line-width": {
        "stops": [
          [10, 1],
          [12, 2],
          [13, 3],
          [14, 5],
          [15, 7],
          [16, 9],
          [17, 11],
          [18, 20]
        ]
      },
      "line-opacity": 1,
      "line-color": "rgba(65, 71, 88, 1)"
    }
  },
  {
    "id": "tunnel_rail",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 13,
    "filter": ["all", ["==", "class", "rail"], ["==", "brunnel", "tunnel"]],
    "layout": { "visibility": "visible", "line-join": "round" },
    "paint": {
      "line-color": "#1a1a1a",
      "line-width": {
        "base": 1.3,
        "stops": [
          [13, 0.5],
          [14, 1],
          [15, 1],
          [16, 3],
          [21, 7]
        ]
      },
      "line-opacity": 0.5
    }
  },
  {
    "id": "tunnel_rail_dash",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 15,
    "filter": ["all", ["==", "class", "rail"], ["==", "brunnel", "tunnel"]],
    "layout": { "visibility": "visible", "line-join": "round" },
    "paint": {
      "line-color": "#111",
      "line-width": {
        "base": 1.3,
        "stops": [
          [15, 0.5],
          [16, 1],
          [20, 5]
        ]
      },
      "line-dasharray": {
        "stops": [
          [15, [5, 5]],
          [16, [6, 6]]
        ]
      },
      "line-opacity": 0.5
    }
  },
  {
    "id": "road_service_case",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 15,
    "maxzoom": 24,
    "filter": ["all", ["==", "class", "service"], ["!has", "brunnel"]],
    "layout": { "line-cap": "round", "line-join": "round" },
    "paint": {
      "line-width": {
        "stops": [
          [15, 1],
          [16, 3],
          [17, 6],
          [18, 8]
        ]
      },
      "line-opacity": 1,
      "line-color": "#1c1c1c"
    }
  },
  {
    "id": "road_minor_case",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 13,
    "maxzoom": 24,
    "filter": ["all", ["==", "class", "minor"], ["!has", "brunnel"]],
    "layout": { "line-cap": "round", "line-join": "round" },
    "paint": {
      "line-width": {
        "stops": [
          [11, 0.5],
          [12, 0.5],
          [14, 2],
          [15, 3],
          [16, 4.3],
          [17, 10],
          [18, 14]
        ]
      },
      "line-opacity": 1,
      "line-color": {
        "stops": [
          [13, "rgba(65, 71, 88, 1)"],
          [15.7, "rgba(65, 71, 88, 1)"],
          [16, "rgba(65, 71, 88, 1)"]
        ]
      }
    }
  },
  {
    "id": "road_pri_case_ramp",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 12,
    "maxzoom": 24,
    "filter": ["all", ["==", "class", "primary"], ["==", "ramp", 1]],
    "layout": { "line-cap": "round", "line-join": "round" },
    "paint": {
      "line-width": {
        "stops": [
          [12, 2],
          [13, 3],
          [14, 4],
          [15, 5],
          [16, 8],
          [17, 10]
        ]
      },
      "line-opacity": {
        "stops": [
          [5, 0.5],
          [7, 1]
        ]
      },
      "line-color": "#232323"
    }
  },
  {
    "id": "road_trunk_case_ramp",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 12,
    "maxzoom": 24,
    "filter": ["all", ["==", "class", "trunk"], ["==", "ramp", 1]],
    "layout": { "line-cap": "round", "line-join": "round" },
    "paint": {
      "line-width": {
        "stops": [
          [12, 2],
          [13, 3],
          [14, 4],
          [15, 5],
          [16, 8],
          [17, 10]
        ]
      },
      "line-opacity": 1,
      "line-color": {
        "stops": [
          [12, "#1a1a1a"],
          [14, "#232323"]
        ]
      }
    }
  },
  {
    "id": "road_mot_case_ramp",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 12,
    "maxzoom": 24,
    "filter": ["all", ["==", "class", "motorway"], ["==", "ramp", 1]],
    "layout": { "line-cap": "round", "line-join": "round" },
    "paint": {
      "line-width": {
        "stops": [
          [12, 2],
          [13, 3],
          [14, 4],
          [15, 5],
          [16, 8],
          [17, 10]
        ]
      },
      "line-opacity": 1,
      "line-color": {
        "stops": [
          [12, "#1a1a1a"],
          [14, "#232323"]
        ]
      }
    }
  },
  {
    "id": "road_sec_case_noramp",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 11,
    "maxzoom": 24,
    "filter": ["all", ["in", "class", "secondary", "tertiary"], ["!has", "brunnel"]],
    "layout": { "line-cap": "round", "line-join": "round" },
    "paint": {
      "line-width": {
        "stops": [
          [11, 0.9],
          [12, 1.5],
          [13, 3],
          [14, 5],
          [15, 6],
          [16, 8],
          [17, 12],
          [18, 16]
        ]
      },
      "line-opacity": 1,
      "line-color": {
        "stops": [
          [11, "rgba(65, 71, 88, 1)"],
          [12.99, "rgba(65, 71, 88, 1)"],
          [13, "rgba(65, 71, 88, 1)"]
        ]
      }
    }
  },
  {
    "id": "road_pri_case_noramp",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 7,
    "maxzoom": 24,
    "filter": ["all", ["==", "class", "primary"], ["!=", "ramp", 1], ["!has", "brunnel"]],
    "layout": { "line-cap": "round", "line-join": "round" },
    "paint": {
      "line-width": {
        "stops": [
          [6, 0.5],
          [7, 0.8],
          [8, 1],
          [11, 3],
          [13, 4],
          [14, 6],
          [15, 8],
          [16, 10],
          [17, 14],
          [18, 18]
        ]
      },
      "line-opacity": {
        "stops": [
          [5, 0.5],
          [7, 1]
        ]
      },
      "line-color": {
        "stops": [
          [7, "#1a1a1a"],
          [12, "#232323"]
        ]
      }
    }
  },
  {
    "id": "road_trunk_case_noramp",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 5,
    "maxzoom": 24,
    "filter": ["all", ["==", "class", "trunk"], ["!=", "ramp", 1], ["!has", "brunnel"]],
    "layout": { "line-cap": "round", "line-join": "round" },
    "paint": {
      "line-width": {
        "stops": [
          [6, 0.5],
          [7, 0.8],
          [8, 1],
          [11, 3],
          [13, 4],
          [14, 6],
          [15, 8],
          [16, 10],
          [17, 14],
          [18, 18]
        ]
      },
      "line-opacity": {
        "stops": [
          [5, 0.5],
          [7, 1]
        ]
      },
      "line-color": {
        "stops": [
          [5, "#1a1a1a"],
          [12, "#232323"]
        ]
      }
    }
  },
  {
    "id": "road_mot_case_noramp",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 5,
    "maxzoom": 24,
    "filter": ["all", ["==", "class", "motorway"], ["!=", "ramp", 1], ["!has", "brunnel"]],
    "layout": { "line-cap": "round", "line-join": "round" },
    "paint": {
      "line-width": {
        "stops": [
          [6, 0.5],
          [7, 0.7],
          [8, 0.8],
          [11, 3],
          [12, 4],
          [13, 5],
          [14, 7],
          [15, 9],
          [16, 11],
          [17, 13],
          [18, 22]
        ]
      },
      "line-opacity": {
        "stops": [
          [6, 0.5],
          [7, 1]
        ]
      },
      "line-color": {
        "stops": [
          [5, "#1a1a1a"],
          [12, "#232323"]
        ]
      }
    }
  },
  {
    "id": "road_path",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 15,
    "maxzoom": 24,
    "filter": ["all", ["in", "class", "path", "track"], ["!has", "brunnel"]],
    "layout": { "line-cap": "round", "line-join": "round" },
    "paint": {
      "line-width": {
        "stops": [
          [15, 0.5],
          [16, 1],
          [18, 3]
        ]
      },
      "line-opacity": 1,
      "line-color": "#262626",
      "line-dasharray": {
        "stops": [
          [15, [2, 2]],
          [18, [3, 3]]
        ]
      }
    }
  },
  {
    "id": "road_service_fill",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 15,
    "maxzoom": 24,
    "filter": ["all", ["==", "class", "service"], ["!has", "brunnel"]],
    "layout": { "line-cap": "round", "line-join": "round" },
    "paint": {
      "line-width": {
        "stops": [
          [15, 2],
          [16, 2],
          [17, 4],
          [18, 6]
        ]
      },
      "line-opacity": 1,
      "line-color": "#0b0b0b"
    }
  },
  {
    "id": "road_minor_fill",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 15,
    "maxzoom": 24,
    "filter": ["all", ["==", "class", "minor"], ["!has", "brunnel"]],
    "layout": { "line-cap": "round", "line-join": "round" },
    "paint": {
      "line-width": {
        "stops": [
          [15, 3],
          [16, 4],
          [17, 8],
          [18, 12]
        ]
      },
      "line-opacity": 1,
      "line-color": "rgba(65, 71, 88, 1)"
    }
  },
  {
    "id": "road_pri_fill_ramp",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 12,
    "maxzoom": 24,
    "filter": ["all", ["==", "class", "primary"], ["==", "ramp", 1]],
    "layout": { "line-cap": "round", "line-join": "round" },
    "paint": {
      "line-width": {
        "stops": [
          [12, 1],
          [13, 1.5],
          [14, 2],
          [15, 3],
          [16, 6],
          [17, 8]
        ]
      },
      "line-opacity": 1,
      "line-color": "#0b0b0b"
    }
  },
  {
    "id": "road_trunk_fill_ramp",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 12,
    "maxzoom": 24,
    "filter": ["all", ["==", "class", "trunk"], ["==", "ramp", 1]],
    "layout": { "line-cap": "square", "line-join": "round" },
    "paint": {
      "line-width": {
        "stops": [
          [12, 1],
          [13, 1.5],
          [14, 2],
          [15, 3],
          [16, 6],
          [17, 8]
        ]
      },
      "line-opacity": 1,
      "line-color": "#0b0b0b"
    }
  },
  {
    "id": "road_mot_fill_ramp",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 12,
    "maxzoom": 24,
    "filter": ["all", ["==", "class", "motorway"], ["==", "ramp", 1]],
    "layout": { "line-cap": "round", "line-join": "round" },
    "paint": {
      "line-width": {
        "stops": [
          [12, 1],
          [13, 1.5],
          [14, 2],
          [15, 3],
          [16, 6],
          [17, 8]
        ]
      },
      "line-opacity": 1,
      "line-color": "rgba(65, 71, 88, 1)"
    }
  },
  {
    "id": "road_sec_fill_noramp",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 13,
    "maxzoom": 24,
    "filter": ["all", ["in", "class", "secondary", "tertiary"], ["!has", "brunnel"]],
    "layout": { "line-cap": "round", "line-join": "round" },
    "paint": {
      "line-width": {
        "stops": [
          [11, 2],
          [13, 2],
          [14, 3],
          [15, 4],
          [16, 6],
          [17, 10],
          [18, 14]
        ]
      },
      "line-opacity": 1,
      "line-color": "rgba(65, 71, 88, 1)"
    }
  },
  {
    "id": "road_pri_fill_noramp",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 10,
    "maxzoom": 24,
    "filter": ["all", ["==", "class", "primary"], ["!=", "ramp", 1], ["!has", "brunnel"]],
    "layout": { "line-cap": "round", "line-join": "round" },
    "paint": {
      "line-width": {
        "stops": [
          [10, 0.3],
          [13, 2],
          [14, 4],
          [15, 6],
          [16, 8],
          [17, 12],
          [18, 16]
        ]
      },
      "line-opacity": 1,
      "line-color": "rgba(83, 86, 102, 1)"
    }
  },
  {
    "id": "road_trunk_fill_noramp",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 10,
    "maxzoom": 24,
    "filter": ["all", ["==", "class", "trunk"], ["!=", "ramp", 1], ["!has", "brunnel"]],
    "layout": { "line-cap": "round", "line-join": "round" },
    "paint": {
      "line-width": {
        "stops": [
          [11, 1],
          [13, 2],
          [14, 4],
          [15, 6],
          [16, 8],
          [17, 12],
          [18, 16]
        ]
      },
      "line-opacity": 1,
      "line-color": "rgba(65, 71, 88, 1)"
    }
  },
  {
    "id": "road_mot_fill_noramp",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 10,
    "maxzoom": 24,
    "filter": ["all", ["==", "class", "motorway"], ["!=", "ramp", 1], ["!has", "brunnel"]],
    "layout": { "line-cap": "round", "line-join": "round" },
    "paint": {
      "line-width": {
        "stops": [
          [10, 1],
          [12, 2],
          [13, 3],
          [14, 5],
          [15, 7],
          [16, 9],
          [17, 11],
          [18, 20]
        ]
      },
      "line-opacity": 1,
      "line-color": "rgba(73, 73, 73, 1)"
    }
  },
  {
    "id": "rail",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 13,
    "filter": ["all", ["==", "class", "rail"], ["!=", "brunnel", "tunnel"]],
    "layout": { "visibility": "visible", "line-join": "round" },
    "paint": {
      "line-color": "#1a1a1a",
      "line-width": {
        "base": 1.3,
        "stops": [
          [13, 0.5],
          [14, 1],
          [15, 1],
          [16, 3],
          [21, 7]
        ]
      }
    }
  },
  {
    "id": "rail_dash",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 15,
    "filter": ["all", ["==", "class", "rail"], ["!=", "brunnel", "tunnel"]],
    "layout": { "visibility": "visible", "line-join": "round" },
    "paint": {
      "line-color": "#111",
      "line-width": {
        "base": 1.3,
        "stops": [
          [15, 0.5],
          [16, 1],
          [20, 5]
        ]
      },
      "line-dasharray": {
        "stops": [
          [15, [5, 5]],
          [16, [6, 6]]
        ]
      }
    }
  },
  {
    "id": "bridge_service_case",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 15,
    "maxzoom": 24,
    "filter": ["all", ["==", "class", "service"], ["==", "brunnel", "bridge"]],
    "layout": { "line-cap": "butt", "line-join": "round" },
    "paint": {
      "line-width": {
        "stops": [
          [15, 1],
          [16, 3],
          [17, 6],
          [18, 8]
        ]
      },
      "line-opacity": 1,
      "line-color": "#1c1c1c"
    }
  },
  {
    "id": "bridge_minor_case",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 13,
    "maxzoom": 24,
    "filter": ["all", ["==", "class", "minor"], ["==", "brunnel", "bridge"]],
    "layout": { "line-cap": "butt", "line-join": "miter" },
    "paint": {
      "line-width": {
        "stops": [
          [11, 0.5],
          [12, 0.5],
          [14, 2],
          [15, 3],
          [16, 4.3],
          [17, 10],
          [18, 14]
        ]
      },
      "line-opacity": 1,
      "line-color": {
        "stops": [
          [13, "#161616"],
          [15.7, "#161616"],
          [16, "#1c1c1c"]
        ]
      }
    }
  },
  {
    "id": "bridge_sec_case",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 11,
    "maxzoom": 24,
    "filter": ["all", ["in", "class", "secondary", "tertiary"], ["==", "brunnel", "bridge"]],
    "layout": { "line-cap": "butt", "line-join": "miter" },
    "paint": {
      "line-width": {
        "stops": [
          [11, 0.5],
          [12, 1.5],
          [13, 3],
          [14, 5],
          [15, 6],
          [16, 8],
          [17, 12],
          [18, 16]
        ]
      },
      "line-opacity": 1,
      "line-color": {
        "stops": [
          [11, "#1a1a1a"],
          [12.99, "#1a1a1a"],
          [13, "#232323"]
        ]
      }
    }
  },
  {
    "id": "bridge_pri_case",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 8,
    "maxzoom": 24,
    "filter": ["all", ["==", "class", "primary"], ["!=", "ramp", 1], ["==", "brunnel", "bridge"]],
    "layout": { "line-cap": "butt", "line-join": "round" },
    "paint": {
      "line-width": {
        "stops": [
          [6, 0.5],
          [7, 0.8],
          [8, 1],
          [11, 3],
          [13, 4],
          [14, 6],
          [15, 8],
          [16, 10],
          [17, 14],
          [18, 18]
        ]
      },
      "line-opacity": {
        "stops": [
          [5, 0.5],
          [7, 1]
        ]
      },
      "line-color": {
        "stops": [
          [8, "#1a1a1a"],
          [12, "#232323"]
        ]
      }
    }
  },
  {
    "id": "bridge_trunk_case",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 5,
    "maxzoom": 24,
    "filter": ["all", ["==", "class", "trunk"], ["!=", "ramp", 1], ["==", "brunnel", "bridge"]],
    "layout": {
      "line-cap": "butt",
      "line-join": "round",
      "visibility": "visible"
    },
    "paint": {
      "line-width": {
        "stops": [
          [6, 0.5],
          [7, 0.8],
          [8, 1],
          [11, 3],
          [13, 4],
          [14, 6],
          [15, 8],
          [16, 10],
          [17, 14],
          [18, 18]
        ]
      },
      "line-opacity": {
        "stops": [
          [5, 0.5],
          [7, 1]
        ]
      },
      "line-color": {
        "stops": [
          [5, "#1a1a1a"],
          [12, "#232323"]
        ]
      }
    }
  },
  {
    "id": "bridge_mot_case",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 5,
    "maxzoom": 24,
    "filter": [
      "all",
      ["==", "class", "motorway"],
      ["!=", "ramp", 1],
      ["==", "brunnel", "bridge"]
    ],
    "layout": { "line-cap": "butt", "line-join": "round" },
    "paint": {
      "line-width": {
        "stops": [
          [6, 0.5],
          [7, 0.8],
          [8, 1],
          [11, 3],
          [12, 4],
          [13, 5],
          [14, 7],
          [15, 9],
          [16, 11],
          [17, 13],
          [18, 22]
        ]
      },
      "line-opacity": {
        "stops": [
          [6, 0.5],
          [7, 1]
        ]
      },
      "line-color": {
        "stops": [
          [5, "#1a1a1a"],
          [10, "#232323"]
        ]
      }
    }
  },
  {
    "id": "bridge_path",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 15,
    "maxzoom": 24,
    "filter": ["all", ["==", "class", "path"], ["==", "brunnel", "bridge"]],
    "layout": { "line-cap": "round", "line-join": "round" },
    "paint": {
      "line-width": {
        "stops": [
          [15, 0.5],
          [16, 1],
          [18, 3]
        ]
      },
      "line-opacity": 1,
      "line-color": "#262626",
      "line-dasharray": {
        "stops": [
          [15, [2, 2]],
          [18, [3, 3]]
        ]
      }
    }
  },
  {
    "id": "bridge_service_fill",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 15,
    "maxzoom": 24,
    "filter": ["all", ["==", "class", "service"], ["==", "brunnel", "bridge"]],
    "layout": { "line-cap": "round", "line-join": "round" },
    "paint": {
      "line-width": {
        "stops": [
          [15, 2],
          [16, 2],
          [17, 4],
          [18, 6]
        ]
      },
      "line-opacity": 1,
      "line-color": "#0b0b0b"
    }
  },
  {
    "id": "bridge_minor_fill",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 15,
    "maxzoom": 24,
    "filter": ["all", ["==", "class", "minor"], ["==", "brunnel", "bridge"]],
    "layout": { "line-cap": "butt", "line-join": "round" },
    "paint": {
      "line-width": {
        "stops": [
          [15, 3],
          [16, 4],
          [17, 8],
          [18, 12]
        ]
      },
      "line-opacity": 1,
      "line-color": "#0b0b0b"
    }
  },
  {
    "id": "bridge_sec_fill",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 13,
    "maxzoom": 24,
    "filter": ["all", ["in", "class", "secondary", "tertiary"], ["==", "brunnel", "bridge"]],
    "layout": { "line-cap": "round", "line-join": "round" },
    "paint": {
      "line-width": {
        "stops": [
          [11, 2],
          [13, 2],
          [14, 3],
          [15, 4],
          [16, 6],
          [17, 10],
          [18, 14]
        ]
      },
      "line-opacity": 1,
      "line-color": "#0b0b0b"
    }
  },
  {
    "id": "bridge_pri_fill",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 11,
    "maxzoom": 24,
    "filter": ["all", ["==", "class", "primary"], ["!=", "ramp", 1], ["==", "brunnel", "bridge"]],
    "layout": { "line-cap": "butt", "line-join": "round" },
    "paint": {
      "line-width": {
        "stops": [
          [11, 1],
          [13, 2],
          [14, 4],
          [15, 6],
          [16, 8],
          [17, 12],
          [18, 16]
        ]
      },
      "line-opacity": 1,
      "line-color": "#0b0b0b"
    }
  },
  {
    "id": "bridge_trunk_fill",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 11,
    "maxzoom": 24,
    "filter": ["all", ["==", "class", "trunk"], ["!=", "ramp", 1], ["==", "brunnel", "bridge"]],
    "layout": {
      "line-cap": "butt",
      "line-join": "round",
      "visibility": "visible"
    },
    "paint": {
      "line-width": {
        "stops": [
          [11, 1],
          [13, 2],
          [14, 4],
          [15, 6],
          [16, 8],
          [17, 12],
          [18, 16]
        ]
      },
      "line-opacity": 1,
      "line-color": "rgba(65, 71, 88, 1)"
    }
  },
  {
    "id": "bridge_mot_fill",
    "type": "line",
    "source": "carto",
    "source-layer": "transportation",
    "minzoom": 10,
    "maxzoom": 24,
    "filter": [
      "all",
      ["==", "class", "motorway"],
      ["!=", "ramp", 1],
      ["==", "brunnel", "bridge"]
    ],
    "layout": { "line-cap": "butt", "line-join": "round" },
    "paint": {
      "line-width": {
        "stops": [
          [10, 1],
          [12, 2],
          [13, 3],
          [14, 5],
          [15, 7],
          [16, 9],
          [17, 11],
          [18, 20]
        ]
      },
      "line-opacity": 1,
      "line-color": "rgba(65, 71, 88, 1)"
    }
  },
  {
    "id": "building",
    "type": "fill",
    "source": "carto",
    "source-layer": "building",
    "layout": { "visibility": "visible" },
    "paint": {
      "fill-color": {
        "base": 1,
        "stops": [
          [15.5, "transparent"],
          [16, "transparent"]
        ]
      },
      "fill-antialias": true
    }
  },
  {
    "id": "building-top",
    "type": "fill",
    "source": "carto",
    "source-layer": "building",
    "layout": { "visibility": "visible" },
    "paint": {
      "fill-translate": {
        "base": 1,
        "stops": [
          [14, [0, 0]],
          [16, [-2, -2]]
        ]
      },
      "fill-outline-color": "#0e0e0e",
      "fill-color": "rgba(57, 57, 57, 1)",
      "fill-opacity": {
        "base": 1,
        "stops": [
          [13, 0],
          [16, 1]
        ]
      }
    }
  },
  {
    "id": "boundary_country_outline",
    "type": "line",
    "source": "carto",
    "source-layer": "boundary",
    "minzoom": 6,
    "maxzoom": 24,
    "filter": ["all", ["==", "admin_level", 2], ["==", "maritime", 0]],
    "layout": { "line-cap": "round", "line-join": "round" },
    "paint": {
      "line-color": "#2C353C",
      "line-opacity": 0.5,
      "line-width": 8,
      "line-offset": 0
    }
  },/*
  {
    "id": "boundary_country_inner",
    "type": "line",
    "source": "carto",
    "source-layer": "boundary",
    "minzoom": 0,
    "filter": ["all", ["==", "admin_level", 2], ["==", "maritime", 0]],
    "layout": { "line-cap": "round", "line-join": "round" },
    "paint": {
      "line-color": {
        "stops": [
          [4, "rgba(92, 94, 94, 1)"],
          [5, "rgba(96, 96, 96, 1)"],
          [6, "rgba(102, 102, 102, 1)"]
        ]
      },
      "line-opacity": 1,
      "line-width": {
        "stops": [
          [3, 1],
          [6, 1.5]
        ]
      },
      "line-offset": 0
    }
  }*/
],
"id": "voyager",
"owner": "Carto"
}

style_json2 = {
  version: 8,
  glyphs:'https://demotiles.maplibre.org/font/{fontstack}/{range}.pbf',
  sources: {
      t_pale: {
          type: 'raster',
          tiles: ['https://cyberjapandata.gsi.go.jp/xyz/pale/{z}/{x}/{y}.png'],
          tileSize: 256,
          attribution:
          '<a href="https://maplibre.org/" target="_blank">MapLibre</a>|<a href="http://www.gsi.go.jp/kikakuchousei/kikakuchousei40182.html" target="_blank">地理院タイル</a>',
      },
  },
  layers: [
      {
          id: 't_pale',
          type: 'raster',
          source: 't_pale',
          minzoom: 0,
          maxzoom: 18,
      },
  ]
}
//テーブルクリア
function clearData() {
  fncViewGraph1(graph_item)
  const elme_table = document.getElementById("sensor_table");
      elme_table.className = ''
      const elme_id = document.getElementById("sensor_id");
      elme_id.textContent = "";
      const elme_value = document.getElementById("sensor_value");
      elme_value.textContent = "";

      const elme_value2 = document.getElementById("sensor_name");
      elme_value2.textContent = "";
      const elme_value3 = document.getElementById("sensor_option1");
      elme_value3.textContent = "";
      const elme_value4 = document.getElementById("sensor_option2");
      elme_value4.textContent = "";
      const elme_value5 = document.getElementById("sensor_option3");
      elme_value5.textContent = "";
      const elme_value6 = document.getElementById("sensor_option4");
      elme_value6.textContent = "";
      const elme_value7 = document.getElementById("sensor_option5");
      elme_value7.textContent = "";  
}

const map = new maplibregl.Map({
    container: 'map',
    style: style_json,
    center: [center_replace],
    zoom: zoom_replace,
    pitch: 45
});


geojson_data = data_replace
map.on('load', function () {
  var nav = new maplibregl.NavigationControl({ visualizePitch: true }); 

  const scale = new maplibregl.ScaleControl({
  maxWidth: 80,
    unit: 'imperial'
  });
 
  map.addControl(scale, 'bottom-right');
  scale.setUnit('metric');
  map.addControl(nav, 'bottom-right');

  make_layers()

    map.fitBounds([
      [bound_replace_1], // southwestern corner of the bounds
      [bound_replace_2] // northeastern corner of the bounds
    ]);
    // マウスcursor
    let enter_flg = false // マウスが地物の上かのフラグ
    map.on('mouseenter', 'point_sample', function() {
      map.getCanvas().style.cursor = 'pointer';
      enter_flg = true;
    });
    map.on('mouseleave', 'point_sample', function() {
      map.getCanvas().style.cursor = '';
      enter_flg = false;
    });

    // マウスクリックイベント
    map.on('click', 'point_sample', function(e) {
      const prop = e.features[0].properties;

      // 表の表示or変更
      const elme_table = document.getElementById("sensor_table");
      elme_table.className = ''
      const elme_id = document.getElementById("sensor_id");
      elme_id.textContent = prop.id;
      const elme_value = document.getElementById("sensor_value");
      elme_value.textContent = prop.value;

      const elme_value2 = document.getElementById("sensor_name");
      elme_value2.textContent = prop.name;
      const elme_value3 = document.getElementById("sensor_option1");
      elme_value3.textContent = prop.option1;
      const elme_value4 = document.getElementById("sensor_option2");
      elme_value4.textContent = prop.option2;
      const elme_value5 = document.getElementById("sensor_option3");
      elme_value5.textContent = prop.option3;
      const elme_value6 = document.getElementById("sensor_option4");
      elme_value6.textContent = prop.option4;
      const elme_value7 = document.getElementById("sensor_option5");
      elme_value7.textContent = prop.option5;

      const elme_legend = document.getElementById("legend_box");
      elme_legend.className = 'legend_box_2'

      // グラフ変更
      fncViewGraph2([prop.id])
    });

    map.on('click', function(e) {
      if (enter_flg == false){
        fncViewGraph1(graph_item)
        //const elme_table = document.getElementById("sensor_table");
        //elme_table.className = 'none'
        //const elme_legend = document.getElementById("legend_box");
        //elme_legend.className = 'legend_box'
      }
      // elseは上記イベント
    });

    // 凡例のスタイルを反映
    for (let i = 0; i < graph_item.length; i++){
      let target = document.getElementById("sp_" + graph_item[i]);
      target.style.backgroundColor = color(graph_item[i]);
    }

    document.getElementById('styles').addEventListener('change', function(event) {
      map.once("styledata", make_layers); 
      const style = event.target.value;
      if (style == 'style1') {
        map.setStyle(style_json);
        document.getElementById('point').checked = true;
      }
      if (style == 'style2') {
        map.setStyle(style_json2);
        document.getElementById('point').checked = true;
      }

    });

    document.getElementById('point').addEventListener('change', function(event) {
      if (this.checked) {
        map.setLayoutProperty('point_sample', 'visibility', 'visible');
        map.setLayoutProperty('point_sample_num', 'visibility', 'visible');
      } else {
        map.setLayoutProperty('point_sample', 'visibility', 'none');
        map.setLayoutProperty('point_sample_num', 'visibility', 'none');
      }
    });
});
async function make_layers() {
    // geojsonソース設定
    map.addSource('point_sample', {
        'type': 'geojson',
        'data': geojson_data
    });

    // 円（点）レイヤ設定
    map.addLayer({
        'id': 'point_sample',
        'type': 'circle',
        'source': 'point_sample',
        'layout': {
          'visibility': 'visible'
        },        
        'paint': {
          "circle-color": [
          'match',
          ['get', 'id'],
          // graph_item[0], color(graph_item[0]),
          map_paint_color_replace,
          ],
          "circle-radius":[
                  "step",
                ["get", "value"],
                circle_range_replace
              ],
          "circle-opacity":0.8,
        }
    });

    // シンボル（数値）レイヤ設定
    map.addLayer({
        'id': 'point_sample_num',
        'type': 'symbol',
        'source': 'point_sample',
        'layout': {
          'visibility': 'visible',
	        'text-field': ['get', 'value'],
	        'text-size': 13
        },
        'paint': {
        	'text-color': 'rgba(255,255,255, 1)'
      	}
    });
}


// *****************************************************
// 日付単位（全計測点）
// *****************************************************

function compare1( a, b ){
  var r = 0;
  if( a.date < b.date ){ r = -1; }
  else if( a.date > b.date ){ r = 1; }

  return r;
}

let graph_item = [graph_item_replace]
graph_data = [graph_datas_replace]

graph_data.sort( compare1 );


let color = null;
let margin = null;

let width_base = graph_data.length * 60

if( width_base < 700) {
    width_base = 700
}

let height_base = 500

fncViewGraph1(graph_item);

function fncViewGraph1(graph_item){
  const series = d3.stack().keys(graph_item)(graph_data);

    const x = d3.scaleBand()
        .domain(graph_data.map(d => d.date)).range([50, width_base - 100])
        .padding(0.1)

    const y = d3.scaleLinear()
        .domain([0, d3.max(series, d => d3.max(d, d => d[1]))]).range([height_base - 100, 30])    

    color = d3.scaleOrdinal()
        .domain(series.map(d => d.key))
        .range(d3.schemeCategory10.slice(0, series.length))
        .unknown("#ccc")

    const date_formate = d => d3.timeFormat("%m/%d")(d3.timeParse("%Y/%m/%d")(d));

    let xAxis = g => g
        .attr("transform",  "translate(" + 0 + "," + (height_base - 100) + ")")
        .attr("class", "x_axis")    
        .call(d3.axisBottom(x).tickSizeOuter(0).tickFormat(date_formate))
        .call(g => g.selectAll(".domain").remove())
        .call(g => g.append("text")
          .attr("x", width_base -100)
          .attr("y", 15)
          .attr("fill", "currentColor")
          .attr("text-anchor", "start")
          .attr("class", "axis2")
          .text("月/日"));

    const max_num = d3.max(series, d => d3.max(d, d => d[1]))
    console.log("max_num", max_num)
    const max_num_unit = function(max_num){
      // １０万以上であれば万にする
      if (max_num >= 100000){
        return [10000, "万"]
      }else{
        return [1, ""]
      }
    }(max_num);
          
    const num_format = d => d/max_num_unit[0];
    let yAxis = g => g
        .attr("transform", "translate(50, 0)")
        .attr("class", "y_axis")
        // .call(d3.axisLeft(y).ticks(null, ",r"))
        .call(d3.axisLeft(y).tickFormat(num_format))
        .call(g => g.selectAll(".domain").remove())
        .call(g => g.append("text")
          .attr("x", -15)
          .attr("y", 20)
          .attr("fill", "currentColor")
          .attr("text-anchor", "start")
          .attr("class", "axis2")
          .text(max_num_unit[1] + "人"));

          // set the dimensions and margins of the graph
    margin = {top: 0, right: 0, bottom: 0, left: 0},
        width = width_base - margin.left - margin.right,
        height = height_base - margin.top - margin.bottom;

    // append the svg object to the body of the page
    d3.select("#graph_dataviz").selectAll("svg").remove(); // いったん削除
    const svg = d3.select("#graph_dataviz")
      .append("svg")
        .attr("width", width_base)
        .attr("height", height_base)
      .append("g")
        .attr("transform",
              "translate(" + margin.left + "," + margin.top + ")");

    svg.append("g")
        .selectAll("g")
        .data(series)
        .join("g")
          .attr("fill", d => color(d.key))
        .selectAll("rect")
        .data(d => d)
        .join("rect")
          .attr("x", (d, i) => x(d.data.date))
          .attr("y", d => y(d[1]))
          .attr("height", d => y(d[0]) - y(d[1]))
          .attr("width", x.bandwidth());
      
      // X軸ラベル追加
    svg.append("g")
        .call(xAxis);

      // Y軸ラベル追加
    svg.append("g")
        .call(yAxis);

}

// *****************************************************
// 個別のグラフ（日時単位）
// *****************************************************

function compare2( a, b ){
  var r = 0;
  if( a.date < b.date ){ r = -1; }
  else if( a.date > b.date ){ r = 1; }

  return r;
}

let graph_item_2 = graph_item // 指定したIDのみにする
graph_data_2 = [graph_datas_2_replace]
graph_data_2.sort( compare2 );

let width_base2 = graph_data_2.length * 20 
let height_base2 = 500


function fncViewGraph2(graph_item_2){
	console.log("fncViewGraph2 called");
  const series_2 = d3.stack().keys(graph_item_2)(graph_data_2);
	const x_2 = d3.scaleBand()
	    .domain(graph_data_2.map(d => d.date)).range([50, width_base2 - 100])
	    .padding(0.1)

	const y_2 = d3.scaleLinear()
	    .domain([0, d3.max(series_2, d => d3.max(d, d => d[1]))]).range([height_base2 - 100, 30])    

	// const date_formate_2 = d => d3.timeFormat("%m/%d %H:%M")(d3.timeParse("%Y/%m/%d %H:%M")(d));
	const date_formate_2 = function(d){
          const date_time = d3.timeParse("%Y/%m/%d %H:%M")(d);
          const format_h = d3.timeFormat("%H")(date_time);
          const format_m = d3.timeFormat("%M")(date_time);
          //if (format_m == '00' && (format_h == '00' ||  format_h == '08' ||  format_h == '16')){
          //  return d3.timeFormat("%m/%d %H:%M")(date_time)
          //}else{
          //  return ""
          //}
          return d3.timeFormat("%m/%d %H:%M")(date_time)
        };  

	// append the svg object to the body of the page
	d3.select("#graph_dataviz").selectAll("svg").remove(); // いったん削除
	const svg_2 = d3.select("#graph_dataviz")
	  .append("svg")
        .attr("width", width_base2)
        .attr("height", height_base2)
	  .append("g")
	    .attr("transform",
	          "translate(0,0)");

	let xAxis_2 = g => g
	    .attr("transform", "translate(" + 0 + "," + (height_base2 - 100) + ")")
	    .attr("class", "x_axis")    
	    .call(d3.axisBottom(x_2).tickSizeOuter(0).tickFormat(date_formate_2))
	    .call(g => g.selectAll(".domain").remove())
	    // .call(g => g.append("text")
	    // 	.attr("x", 600)
	    // 	.attr("y", 15)
	    // 	.attr("fill", "currentColor")
	    // 	.attr("text-anchor", "start")
	    //   .attr("class", "axis2")
	    //  	.text("日時"));
      .selectAll("text")  
            .style("text-anchor", "end")
            .attr("dx", "-.8em")
            .attr("dy", ".1em")
            .attr("transform", "rotate(-90)" )

	let yAxis_2 = g => g
	    .attr("transform", "translate(50, 0)")
	    .attr("class", "y_axis")
	    .call(d3.axisLeft(y_2).ticks(null, ",r"))
	    .call(g => g.selectAll(".domain").remove())
	    .call(g => g.append("text")
	      .attr("x", -15)
	    	.attr("y", 20)
	    	.attr("fill", "currentColor")
	    	.attr("text-anchor", "start")
	      .attr("class", "axis2")
	     	.text("人"));

	svg_2.append("g")
	    .selectAll("g")
	    .data(series_2)
	    .join("g")
	      .attr("fill", d => color(d.key))
	    .selectAll("rect")
	    .data(d => d)
	    .join("rect")
	      .attr("x", (d, i) => x_2(d.data.date))
	      .attr("y", d => y_2(d[1]))
	      .attr("height", d => y_2(d[0]) - y_2(d[1]))
	      .attr("width", x_2.bandwidth());
	  
	  // X軸ラベル追加
	svg_2.append("g")
	     .call(xAxis_2);

	  // Y軸ラベル追加
	svg_2.append("g")
	     .call(yAxis_2);

}


</script>

 
</body>
</html>